#!/usr/bin/env python3

import rospy
import time
from sensor_msgs.msg import Joy
import sys
import signal
import numpy as np

class JoyRepub(object):
    def __init__(self):
        rospy.init_node('joy_repub')
        self._joy = None
        self._joy_pub = rospy.Publisher('/joy', Joy, queue_size=1)
        self._joy_sub = rospy.Subscriber('/ui/joy', Joy, self.on_joy)
        self._rate = rospy.Rate(10.0)

    def on_joy(self, msg):
        self._joy = msg

    def run(self):
        while not rospy.is_shutdown():
            if self._joy is not None:

                ax = np.array(self._joy.axes)
                buttons = np.array(self._joy.buttons)
                if np.max(buttons)>0 or np.max(np.abs(ax))>0:
                    self._joy_pub.publish(self._joy)
            self._rate.sleep()

    def signal_handler(self, signal, frame):
        sys.exit()

if __name__ == "__main__":
    rospy.init_node('joy_repub')
    joy_repub = JoyRepub()
    signal.signal(signal.SIGINT, joy_repub.signal_handler)
    joy_repub.run()